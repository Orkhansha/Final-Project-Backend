@model OrderVM

@{
    ViewData["Title"] = "Basket";
    decimal totalprice = 0;

}

<main>
 
    <section class="shopping-cart">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                   
                    <table class="table bg-white">
                        <thead>
                            <tr>
                                <th class="image">Image</th>
                                <th class="item">Items</th>
                                <th class="price">Price</th>
                                <th class="qty">Quantity</th>
                                <th class="total-price">Total</th>
                                <th class="total-price">Remove</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model.BasketItems)
                            {
                                <span style="display:none">@(totalprice += item.Count * item.Product.Price)</span>
                                <tr class="cart-items">
                                    <td class="item-info">
                                        <div class="item-image-info">
                                            <div class="item-image">
                                                @foreach (var photo in item.Product.ProductImages)
                                                {
                                                    @if (photo.IsMain)
                                                    {
                                                        
                                                <a href="">
                                                    <img width="100" src="~/img/products/@photo.ImageUrl" alt="">
                                                </a>
                                                    }
                                                    
                                                }
                                            </div>
                                           
                                        </div>
                                    </td>
                                    <td>
                                        <div class="item-title">
                                            <a asp-controller="Product" asp-action="detail" asp-route-id="@item.Product.Id" style="text-decoration:none;">
                                                <span class="item-name">

                                                    @item.Product.Title

                                                </span>
                                            </a>


                                        </div>
                                    </td>
                                    <td class="item-price">
                                        <span class="money">

                                            @item.Product.Price


                                        </span>
                                    </td>
                                    <td class="item-quantity">
                                        <div class="inp-num">
                                            <a data-id="@item.Product.Id" class="down" id="downbtn"><i class="fas fa-chevron-left"></i></a>
                                            <span class="inp-value">@item.Count</span>
                                            <a data-id="@item.Product.Id" class="up" id="upbtn"><i class="fas fa-chevron-right"></i></a>
                                        </div>
                                    </td>
                                    <td class="item-total ">


                                        <span data-id="@item.Product.Id" class="money-t">

                                            <span>@(item.Count * item.Product.Price)</span>


                                        </span>
                                    </td>
                                     <td class="item-quantity">
                                        <div class="remove">
                                            <a asp-controller="basket" asp-action="removecartitem" asp-route-id="@item.Product.Id" class="cart-remove-btn">
                                                <span>Remove</span>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                            }



                        </tbody>
                    </table>
                    <div class="card-body bg-white">
                            <h4>Total Price</h4>
                            $<span class="total_price"><span>@totalprice</span></span>
                    </div>

                    <div class="card-footer bg-white">
                        <button class="button-64" role="button"><a asp-controller="Order" asp-action="Index" class="text">Sifarişi təsdiq et !</a></button>
                    </div>
                </div>
                
            </div>
        </div>
    </section>

</main>

@section Scripts{
    <style>
        

.button-64 {
    align-items: center;
    background-image: linear-gradient(144deg,#AF40FF, #5B42F3 50%,#00DDEB);
    border: 0;
    border-radius: 8px;
    box-shadow: rgba(151, 65, 252, 0.2) 0 15px 30px -5px;
    box-sizing: border-box;
    color: #FFFFFF;
    display: flex;
    font-family: Phantomsans, sans-serif;
    font-size: 20px;
    justify-content: center;
    line-height: 1em;
    max-width: 100%;
    min-width: 140px;
    padding: 3px;
    text-decoration: none;
    user-select: none;
    -webkit-user-select: none;
    touch-action: manipulation;
    white-space: nowrap;
    cursor: pointer;
}


.button-64:active,
.button-64:hover {
    outline: 0;
}

.button-64 a {
    text-decoration: none;
    background-color: rgb(5, 6, 45);
    padding: 16px 24px;
    border-radius: 6px;
    width: 100%;
    height: 100%;
    transition: 300ms;
}


.button-64:hover a {
    color: black;
    background: none;
}



@@media (min-width: 768px) {
    .button-64 {
        font-size: 24px;
        min-width: 196px;
    }
}

    </style>
}










@section ScriptsJs{
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
   
    <script>
        var myInp = document.querySelectorAll(".inp-num .inp-value");
        var increaseBtn = document.querySelectorAll(".inp-num .up");
        var decreaseBtn = document.querySelectorAll(".inp-num .down");
        for (let elem of decreaseBtn) {

            elem.addEventListener("click", function (e) {
                e.preventDefault()
                countst = this.nextElementSibling.innerText
                countstn = Number(countst)

                if (countstn > 1) {
                    count = this.nextElementSibling.innerText
                    countn = Number(count)
                    countn -= 1;
                    this.nextElementSibling.innerText = countn;
                }
            })
        }
        for (let elem of increaseBtn) {

            elem.addEventListener("click", function (e) {
                e.preventDefault()
                count = this.previousElementSibling.innerText
                countn = Number(count)
                countn += 1;
                this.previousElementSibling.innerText = countn;


            })
        }
        $(".cart-remove-btn").click(function (e) {
            e.preventDefault()
 
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    var link = $(this).attr("href");
                    fetch(link).then(response => response.json()).then(data => {
                        if (data.status == 200) {
                            location.reload(true)
                        } else {
                            Swal.fire(
                                'Not found!',
                                'Your file can not be deleted.',
                                'Failed'
                            )
                        }
                    });
                }
            })
        })
        $(".removeall").click(function (e) {
            e.preventDefault()
            
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete all!'
            }).then((result) => {
                if (result.isConfirmed) {
                    var link = $(this).attr("href");
                    fetch(link).then(response => response.json()).then(data => {
                        if (data.status == 200) {
                            location.reload(true)
                        } else {
                            Swal.fire(
                                'Not found!',
                                'Your file can not be deleted.',
                                'Failed'
                            )
                        }
                    });
                }
            })
        })
    </script>
    <script>

        $(document).ready(function () {

            $(document).on("click", ".down", function (e) {
                e.preventDefault();
                var id = $(this).attr("data-id")
                var total = document.querySelector(".total_price")
                var money = document.querySelectorAll(".money-t")
                
                $.ajax({
                    url: "/basket/minus",
                    data: {
                        id: id
                    },
                    type: "post",
                    datatype: "json",
                    success: function (data) {
                        money.forEach(mon => {
                            if (id == mon.getAttribute("data-id")) {
                                mon.innerHTML = data.price
                                
                            }
                        })
                        total.innerHTML = `${data.totalPrice}`

                    }
                })

            })


            $(document).on("click", ".up", function (e) {
                e.preventDefault();
                var id = $(this).attr("data-id")
                var total = document.querySelector(".total_price")
                var money = document.querySelectorAll(".money-t")
               
                $.ajax({
                    url: "/basket/plus",
                    data: {
                        id: id
                    },
                    type: "post",
                    datatype: "json",
                    success: function (data) {
                        money.forEach(mon => {
                            if (id == mon.getAttribute("data-id")) {
                                mon.innerHTML = data.price
                            
                            }
                        })
                        total.innerHTML = `${data.totalPrice}`

                    }
                })

            })


        })


    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prefixfree/1.0.7/prefixfree.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous">
    </script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

        }